{
    "size": 0,
    "query": {
        "bool": {
            "filter": [
                {
                    "term": {
                        "kubernetes.deployment.name": "elasticsearch-metrics-apiserver"
                    }
                },
                {
                    "term": {
                      "prometheus.labels.client": "k8s-observability-cluster"
                    }
                },
                {
                    "term": {
                      "prometheus.labels.type": "custom"
                    }
                },
                {
                    "exists": {
                        "field": "prometheus.metrics_count.value"
                    }
                },
                {
                    "range": {
                        "@timestamp": {
                            "gte": "now-10m"
                        }
                    }
                }
            ]
        }
    },
    "aggs": {
        "podNames":{
            "terms": {
                "size": 50,
                "field": "kubernetes.pod.name"
            },
            "aggs":{
              "latest_result": {
                "top_hits": {
                  "size": 1,
                  "sort": [
                    {
                      "@timestamp": "desc"
                    }
                  ],
                  "_source": {
                    "includes": [
                      "prometheus.metrics_count.value",
                      "@timestamp"
                      ]
                  }
                }
              }
            }
        }
        
    }
}